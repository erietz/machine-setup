- name: Check if miniconda is installed
  stat: path={{ _miniconda_dir }}/bin/conda
  register: bin_conda
  changed_when: bin_conda.stat.exists == False

- name: Download miniconda installer for Linux
  become: False
  get_url:
    url: https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    dest: /tmp/install-miniconda.sh
    checksum: sha256:78f39f9bae971ec1ae7969f0516017f2413f17796670f7040725dd83fcff5689
    mode: 0755
  register: miniconda_downloaded
  when: (bin_conda.stat.exists == False) and (ansible_distribution != "MacOSX")

- name: Download miniconda installer for MacOS (Intel x86)
  become: False
  get_url:
    url: https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh
    dest: /tmp/install-miniconda.sh
    checksum: sha256:007bae6f18dc7b6f2ca6209b5a0c9bd2f283154152f82becf787aac709a51633
    mode: 0755
  register: miniconda_downloaded
  when: (bin_conda.stat.exists == False) and (ansible_distribution == "MacOSX")

- name: Run miniconda installer
  become: False
  ansible.builtin.command:
    argv:
      - /tmp/install-miniconda.sh
      - -b
      - -p
      - "{{ _miniconda_dir }}"
